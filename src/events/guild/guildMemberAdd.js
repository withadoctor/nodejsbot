const { BitField } = require("discord.js")
const moment = require('moment-timezone');

const blackList = [
    '298333126143377419', // 2Tae
    '303065328957784067', // Ensa
    '306680580177657857', // ì¼ë¯¼ì´ìŠ¤ ë”” ê½ê½ë¥´ ì–´ë¥´ë¥´ ë½€ë¡œë¡œ
    '340297840712744963', // Happy Angel
    '359615403619516427', // ğ“¬ğ“±ğ“¸ğ“¼ğ“ªğ“·ğ“´ğ“»ğ“¾
    '375278783294341122', // í•´ì¤€
    '404615239519174678', // 6ê°œì›”ë§Œì— ë³¸ëª…ì¸ ê°•í˜ìœ¤
    '415395433326706688', // 0801
    '416468145524703244', // ! BLACK
    '427119032164941824', // OwnerPower
    '428865804990283779', // ì´ëŒ€ë§Œ
    '440760122382483466', // ì„œì¤€
    '456055565962051595', // Deleted User 17828168
    '465740126526373912', // ìµœí”Œ936
    '470518528563216384', // ì‚¼ìƒ‰ì´
    '485767968869974026', // ë„¤ì˜¨
    '492194419009650699', // ì²­í…Œì´í”„
    '493040511569887232', // Jwon
    '495612549127995409', // ã¤ ë² í”„
    '496945218696904705', // 416
    '498822284992315423', // KKYUNG
    '501384055674109952', // Shaker
    '507911080127758346', // íƒœìš°
    '511070420179615744', // ë¥˜í•œì¤€
    '511107234608971776', // ë•…ì½©
    '515733500523970594', // ìœ ìˆ˜ì •
    '517182152656551966', // ë„¤ì¦ˆì½”
    '527688861233578074', // ì´ìŠ¹í˜„
    '527740763409350665', // í©ì‹œì¶© ë³¼ë¦¬ë² ì–´(ì‹ ì„±)
    '528921715561070594', // ê°ìŸˆ
    '529979377140891649', // ! LOST
    '530648991613059074', // ì§„_ì ì£¼
    '534202677148647425', // ì‹¹í‰ë°”ê°€ì§€
    '534237409496530965', // ì‹œë¦¬
    '537044651459477504', // CARTEL
    '540016222390059018', // â™•ë¬´ë„ˆ
    '540515497972727808', // !TOP
    '542337775702245386', // ! LION
    '542620661672312832', // ê°œì¸ì‚¬ì •ìœ¼ë¡œ ì ì‹œ í™œë™ ì¤‘ë‹¨í•©ë‹ˆë‹¤.Dm,ë§¨ì…˜ ëª»ë´…ë‹ˆë‹¤
    '543739748351606804', // Deleted User 5cee1f71
    '544116861886005259', // ìœ ì¹˜ì› ì‹¸ì›€ 1ì§±
    '544147618729558018', // ë³µê·€ í”¼ì—”
    '545433624611389451', // ã…¡blackã…¡
    '547586808121262080', // ğ‰ğ¢ ğ–ğ¨ğ§
    '556300258716418050', // RainbowGODPO
    '557801493038759958', // X01X01
    '558509716066795543', // ì´ìŒ©ìŒ©ì´ë‹¤ ì¸ì„±ë¬¸ì œìˆì–´?
    '561809805329825799', // ë¦¬ì˜¤ë‹ˆ
    '563240569892241409', // ìœ ì¤€
    '572383254397583360', // TeamSD | user
    '576706730495311872', // coupleta
    '578873063513391116', // êµ¿ì›”ë“œì™€ìš°
    '579976067637444610', // flash_bomb
    '585744706797830155', // TItanumapple
    '596997938543198257', // Qlssm
    '602459845534416896', // ! í‚¤ì‹œ !
    '605583327038144530', // ........
    '609348810921213962', // ê±´ìš°
    '609357177257328663', // ê°€ë¼
    '613227359574687745', // KimMoSse
    '617339982033453056', // seize
    '619741257404514357', // í ë©”í ë©”
    '622048175892725786', // ë°ì€ì€í•˜
    '622227283054166017', // ì‘ë””_77ã…“ì–µ
    '625299782860275722', // wa yangazi
    '628918843045183489', // ì‹¤í—˜ì±„
    '634319004671934464', // HIPITINI
    '638314711678582794', // YouTubebentley
    '640425984599785472', // oh my god
    '640794267039694871', // ! ì½”ì§€
    '641591736438620180', // ! ì¡°ë§ˆ
    '645530359202578443', // ê¹€ë˜í˜
    '650280702205755403', // à¼ºà§¡Û£ÍœÍ¡à§¡WONà§¡Û£ÍœÍ¡à§¡à¼»
    '655733457363795980', // ìŠ¹í˜„
    '659037810992480259', // Dugom
    '660078363997896716', // Faker---Inu
    '660428937213771776', // í•œë‹´
    '661110691675242507', // íš¨ëª¨
    '664486712080334885', // ëƒëƒ¥
    '665972656889266176', // ë…¸ì„
    '667927803764932659', // ì½”ë°”ì‹œ
    '669764831510921217', // ì¼ë¯¼ì´
    '674237132675481631', // ã…‡ã…ã…ˆ
    '675531242846027786', // Deleted User 1c0dc5c7
    '681138538288644101', // LEMON
    '682221881071239234', // ì”¨ì¼ë¯¼(ê¥ªí·íŸ¤ê¥°í¸íŸ ê¥¹í½íŸ»)
    '684359991637180491', // ë¡œë½
    '685497398113730560', // í† ëª¨ë¦¬
    '686010865333567500', // Deleted User 6bcbcd77
    '687562947790503974', // dwjk64
    '688029278293590032', // ë‹¤ë§ˆìŠ¤
    '690525243395014716', // ê§à¼’â€¢ã€Œ  ë¯¸íˆ¬ ã€â€¢à¼’ê§‚
    '690732528499163186', // skyblue
    '692290446290059325', // í•˜ëŠ˜ì°¡
    '692324859224522753', // ì»´í•˜ëŠ” ë£¨íŠ¸ [root]
    '692942038273884201', // NEON
    '700037067262001756', // Deleted User 241d7c34
    '700115960442388502', // ì•Œì¼€ì´
    '701362896478929007', // Deleted User 18570abf
    '703074607321579631', // Barong2
    '704708657635393536', // EXâ„¢2l_-
    '704930959362883604', // ë§Œë‘
    '708288349068329080', // ê¹€ê·¼íƒœ
    '709726424671584336', // . .
    '710041369787367494', // [ë°±ê³¨ë¶€ëŒ€]yewto9399
    '710057289125593099', // ìŠ¹ì§„
    '710106184765407253', // ..;
    '714048051177586710', // maoper
    '715353979365621821', // ì„ê¸ˆ
    '717375101141778483', // ê·¸ëŒ
    '717972065721778249', // YQY
    '719335030182379560', // ì•…ë™
    '720593872605937725', // goodwhatthe
    '720631009825259561', // ì´ë¯¸ì§€
    '722050711332061205', // 'Í¡ì–¸ì–´ë„ë‹¨ ìµœë´‰ë‹¬
    '723791515096186901', // ! LOOK AT YOU(ê¼¬ê¼¬)
    '724431478729211975', // Deleted User 12637c24
    '724499829262385172', // :santa:Ä¹Ä”ÃÃ˜ÅŠ:church:
    '724884124451602484', // SAY
    '726333000660418621', // ì¼ë°˜ì ì¸ ì‚¬ëŒìƒˆë¼
    '728936176383426572', // Swe0y:crown:
    '730224887871832126', // Deleted User f4fba9d9
    '731245602716778529', // Deleted User e658d14d
    '731496615759839304', // 14ë¯¼ìˆ˜ì˜ ê·€í™˜
    '732565390672003092', // gangta
    '734347840192643139', // Deleted User 7bc39222
    '734928774528892978', // TRUE
    '737562306728296471', // :woman:ğŸ¦²:handshake::man:ğŸ¦²
    '739382915359703040', // killop00
    '739731779195502636', // [AFK]Spirit
    '740087465989242902', // ë¹…ì‹€ë¹„
    '740213372074852384', // ! JS(?)>Python>HTML,CSS
    '740448575930236978', // íì–´ ã… 
    '740852514328543292', // ë‚˜ê¸‹í•´ ë°”ë³´
    '742038608722002020', // ì„ë£¨íŒ¬íŒŒí¬ìµ
    '742329073174577163', // VICKIE
    '742747407854469180', // token
    '742810119665877050', // ê·¼íƒœ
    '743101455279587398', // ì´ë¦„ì—†ìŒ
    '743429399956947067', // í•˜ëŠ˜ì…ë‹ˆë‹¤
    '745085276954558504', // BEAR
    '747370096082550824', // Deleted User abccf756
    '748913906139005043', // rohcke10
    '749568405299921016', // 017ARYUNG
    '749773835338776576', // ë§Œë‘ ì¢‡ë³‘ì‹ 
    '749974167947968573', // GRT ROSSN
    '750288268989562883', // ã…ã…‡ã…ã…‡
    '751774719673630750', // íƒ€ì´ë¨¸
    '753418918328139899', // ë§¹êµ¬!
    '753807551484919899', // ë‚˜ê¸‹í•´ ã…—
    '753808205548617750', // ë‚˜ê¸‹í•´ ã…—ã…—ã…—ã…—ã…—ã…—ã…—
    '755634547495927818', // gunWo
    '757108508184281160', // ë‚˜ê¸‹í•´ ê°•ì•„ì§€
    '757395325970284574', // ê³„ì •ë²„ë¦¼
    '758891650625568809', // ì •ì¥¬ì„ë‹ˆë‹¤
    '764331019620188160', // ë‚˜ê¸‹í•´ ë³‘ì‹ ìƒˆë¼
    '764332622796947496', // ë‚˜ê¸‹í•´ ë’¤ì ¸ë¼
    '764332975390326855', // ë‚˜ê¸‹í•´ ì• ë¯¸ ë’¤ì ¸ë¼
    '764333801266085948', // ë‚˜ê¸‹í•´ ì”¨ë°œ
    '764334265965084702', // ë‚˜ê¸‹í•´ ë³‘ì‹ ìƒˆë¼
    '765861963149475841', // ê±_ìœ ì €
    '767969439810715658', // ì € ì‚¬ì‹¤ ì§€í˜¸ì—ìš” ì‹ ê³ ë§Œ í•˜ì§€ ë§ì•„ì£¼ì„¸ìš”
    '768100486787104768', // ë‚˜ê¸‹í•´ ë³‘ì‹ ìƒˆë¼ ê¼­ ë‚˜ê°€ ë’¤ì§€ì„¸ìš”
    '768101287979122709', // ì™œ ë°˜ì‘ ì•ˆí•˜ë‹ˆ ë‚˜ê¸‹í•´ ë³‘ì‹ 
    '769208755999997962', // ë‚˜ê¸‹í•´ ë³‘ì‹ 
    '771735986216501289', // í¬ì‹œ
    '772330880886112316', // ë‚˜ê¸‹í•´ ê± ë³‘ì‹  ë’¤ì €ë¼
    '772334931254575148', // ë‚˜ê¸‹í•´ë³‘ì‹ ì•„ë‹ˆê°€ììœ ì±„íŒ…ì—ë°˜ì‘ì•ˆí•˜ë©´ë”í•¨
    '772339132877766677', // ã„´ã…‡ã„¹
    '772340864466681866', // ë ˆì—‰
    '773419190317088769', // ë‚˜ê¸‹í•´ ë³‘ì‹ ìƒˆë¼ ê²¨ë“œë‘ì´ ëƒ„ì„¸ ì˜¤ì§€ê³  ì„¹ìŠ¤
    '777119790111916033', // ë³´ì´ìŠ¤ test
    '777715348971454484', // ë‚œêµ¿
    '778929203734642719', // STame
    '778979376037494825', // ë¯¼ì´ˆ
    '779220349551509565', // dì—
    '780379247050752030', // mindata ìƒŒì¦ˆ
    '781113259171774475', // Rosolho
    '782588331980357652', // ë¶€ì‚°ìœ í•™
    '782594890403938304', // ëª¸ì¥ëŒ€í‘œ
    '783845873838719028', // ã…ã…
    '772333660623863818',
    '773419577383583794',
    '773420421323292693',
    '773421028662968360',
    '773457637148721153',
]
// const welcomeChannelName = "ì•ˆë…•í•˜ì„¸ìšœ" // ì…ì¥ ì‹œ í™˜ì˜ë©”ì‹œì§€ë¥¼ ì „ì†¡ í•  ì±„ë„ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.
const welcomeChannelId = 794119277703462942 // ì…ì¥ ì‹œ í™˜ì˜ë©”ì‹œì§€ë¥¼ ì „ì†¡ í•  ì±„ë„ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.
const welcomeChannelComment = "ì–´ì„œì˜¤ì„¸ìš”." // ì…ì¥ ì‹œ ì „ì†¡í•  í™˜ì˜ë©”ì‹œì§€ì˜ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.
const roleName = "ê²ŒìŠ¤íŠ¸" // ì…ì¥ ì‹œ ì§€ê¸‰ í•  ì—­í• ì˜ ì´ë¦„ì„ ì ì–´ì£¼ì„¸ìš”.

module.exports = async (bot, member) => {
    // ê°€ì…í•œì§€ 30ë¶„ì´ ì§€ë‚˜ì§€ ì•Šì•˜ê³ ,
    // ì•„ë°”íƒ€ ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ë°´.
    let condition1 = moment.duration(moment(new Date()).locale('ko').diff(moment(member.user.createdTimestamp).locale('ko'))).asMinutes() < 30;
    let condition2 = member.user.defaultAvatarURL == member.user.displayAvatarURL();
    let condition3 = member.user.username.indexOf('ë‚˜ê¸‹í•´') != -1;
    if (condition1) member.ban();
    if (condition1 && condition2) member.ban();

    if (condition3) member.ban();


    const guild = member.guild
    const newUser = member.user
    // const welcomeChannel = guild.channels.cache.find((channel) => channel.name == welcomeChannelName)
    const welcomeChannel = guild.channels.cache.find((channel) => channel.id == welcomeChannelId)

    welcomeChannel.send(`<@${newUser.id}> ${welcomeChannelComment}\n`) // ì˜¬ë°”ë¥¸ ì±„ë„ëª…ì„ ê¸°ì…í•˜ì§€ ì•Šì•˜ë‹¤ë©´, Cannot read property 'send' of undefined; ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.

    let guestrole = guild.roles.cache.find((r) => r.name === roleName)
    if (!guestrole) {
        try {
            guestrole = await guild.roles.create({
                data: {
                    name: roleName,
                    color: bot.colours.green_light,
                },
                reason: '',
            })
            guestrole.setPermissions(new BitField(0)); // ì–´ë–¤ ê¶Œí•œë„ ì—†ëŠ” ìƒíƒœ
        } catch (e) {
            console.log(e.stack);
        }
    }

    member.roles.add(guestrole.id)


    // let banAlertChannel;
    // if(process.env.NODE_ENV == 'live') {
    //     banAlertChannel = bot.guilds.cache.find(x => x.name == 'ë‚˜ê¸‹í•´_ìœ íŠœë¸Œ_ì±„ë„').channels.cache.find(x => x.name == 'ê²½ê³ ');
    // }
    // else if(process.env.NODE_ENV == 'qa') {
    //     banAlertChannel = bot.guilds.cache.find(x => x.name == '__youtube_test').channels.cache.find(x => x.name == 'ì¼ë°˜');
    // }
    // else {
    //     console.log('guildMemberAdd ë²„ê·¸ë‚¬ë‹¹..?');
    //     return;
    // }

    for (bl of blackList) {
        let kick_msg = member.user.username + '#' + member.user.discriminator + 'ì´(ê°€) ê°•í‡´ì‹œì¼°ìŠµë‹ˆë‹¤.';

        let user = member.guild.members.cache.find(x => x.id == bl)
        if (user) {
            // console.log(user.user)
            // banAlertChannel
            //     .send(`<@${user.id}> ${user.user.username}#${user.user.discriminator}ëŠ” ë¸”ë™ë¦¬ìŠ¤íŠ¸ì— ìˆëŠ” ìƒˆë¼ë¼ì„œ ë°´ë‹¹í–ˆìŠµë‹ˆë‹¤.`);
            user.ban(kick_msg)
            // break;
        }
    }
}